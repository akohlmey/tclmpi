<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TclMPI: TclMPI Developer&#39;s Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TclMPI
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">Tcl Bindings for MPI</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('devguide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TclMPI Developer's Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document explains the implementation of the Tcl bindings for MPI implemented in TclMPI. The following sections will document how and which MPI is mapped to Tcl and what design choices were made.</p>
<h1><a class="anchor" id="design"></a>
Overall Design and Differences to the MPI C-bindings</h1>
<p>To be consistent with typical Tcl conventions all commands and constants in lower case and prefixed with tclmpi, so that clashes with existing programs are reduced. This is not yet set up to be a proper namespace, but that may happen at a later point, if the need arises. The overall philosophy of the bindings is to make the API similar to the MPI one (e.g. maintain the order of arguments), but don't stick to it slavishly and do things the Tcl way wherever justified. Convenience and simplicity take precedence over performance. If performance matters that much, one would write the entire code C/C++ or Fortran and not Tcl. The biggest visible change is that for sending data around, receive buffers will be automatically set up to handle the entire message. Thus the typical "count" arguments of the C/C++ or Fortran bindings for MPI is not required, and the received data will be the return value of the corresponding command. This is consistent with the automatic memory management in Tcl, but this convenience and consistency will affect performance and the semantics. For example calls to <a class="el" href="namespacetclmpi.html#abd8a5649a21edb8bb9923c373cd4cb38">tclmpi::bcast</a> will be converted into <em>two</em> calls to MPI_Bcast(); the first will broadcast the size of the data set being sent (so that a sufficiently sized buffers can be allocated) and then the second call will finally send the data for real. Similarly, <a class="el" href="namespacetclmpi.html#a7d7dd86f25e6c531231e4c4eabf22117">tclmpi::recv</a> will be converted into calling MPI_Probe() and then MPI_Recv() for the purpose of determining the amount of temporary storage required. The second call will also use the MPI_SOURCE and MPI_TAG flags from the MPI_Status object created for MPI_Probe() to make certain, the correct data is received.</p>
<p>Things get even more complicated with with non-blocking receives. Since we need to know the size of the message to receive, a non-blocking receive can only be posted, if the corresponding send is already pending. This is being determined by calling MPI_Iprobe() and when this shows no (matching) pending message, the parameters for the receive will be cached and the then MPI_Probe() followed by MPI_Recv() will be called as part of <a class="el" href="namespacetclmpi.html#a3b6ece078454ce26880f0b57ac827d21">tclmpi::wait</a>. The blocking/non-blocking behavior of the Tcl script should be very close to the corresponding C bindings, but probably not as efficient.</p>
<h1><a class="anchor" id="naming"></a>
Naming Conventions</h1>
<p>All functions that are new Tcl commands follow the MPI naming conventions, but using TclMPI_ as prefix instead of MPI_. The corresponding Tcl commands are placed in the tclmpi namespace and all lower case. Example: <a class="el" href="group__wrappers.html#ga738cbe476e7ccfd4aced07b4dd433587">TclMPI_Init()</a> is the wrapper for MPI_Init() and is provided as command <a class="el" href="namespacetclmpi.html#a2afa6bd54eb108e1e6155259132edf44">tclmpi::init</a>. Defines and constants from the MPI header file are represented in TclMPI as plain strings, all lowercase and with a tclmpi:: prefix. Thus MPI_COMM_WORLD becomes <a class="el" href="namespacetclmpi.html#a59fb2c1ff4f847ecb1e4fe4fa5b89b9e" title="constant for world communicator">tclmpi::comm_world</a> and MPI_INT becomes <a class="el" href="namespacetclmpi.html#a1cabae47e0cff6dfb26f3013347158ac" title="constant for integer data type">tclmpi::int</a>.</p>
<p>Functions that are internal to the plugin as well as static variables are prefixed with all lower case, i.e. tclmpi_. Those functions have to be declared static.</p>
<p>All string constants are also declared as namespace variables, e.g. $tclmpi::comm_world, so that shortcut notations are possible as shown in the following example: </p><div class="fragment"><div class="line">namespace upvar tclmpi comm_world comm</div>
<div class="line">namespace upvar tclmpi int        mpi_int</div>
</div><!-- fragment --><h1><a class="anchor" id="Internal"></a>
TclMPI Support Functions</h1>
<p>Several MPI entities like communicators, requests, status objects cannot be represented directly in Tcl. For TclMPI they need to be mapped to something else, for example a string that will uniquely identify this entity and then it will be translated into the real object it represents with the help of the following support functions.</p>
<h2><a class="anchor" id="tclcomm"></a>
Mapping MPI Communicators</h2>
<p>MPI communicators are represented in TclMPI by strings of the form "tclmpi::comm%d", with "%d" being replaced by a unique integer. In addition, a few string constants are mapped to the default communicators that are defined in MPI. These are <a class="el" href="namespacetclmpi.html#a59fb2c1ff4f847ecb1e4fe4fa5b89b9e" title="constant for world communicator">tclmpi::comm_world</a>, <a class="el" href="namespacetclmpi.html#a4f7336cfd7f45ba2f38ec72adebc5b88" title="constant for self communicator">tclmpi::comm_self</a>, and <a class="el" href="namespacetclmpi.html#a3e90906d53f8730ad48783c9aaad706e" title="constant empty communicator">tclmpi::comm_null</a>, which represent MPI_COMM_WORLD, MPI_COMM_SELF, and MPI_COMM_NULL, respectively.</p>
<p>Internally the map is maintained in a simple linked list which is initialized with the three default communicators when the plugin is loaded and where new communicators are added at the end as needed. The functions <a class="el" href="group__supportfn.html#gab74e438d4cb84c83bc34d0e4a4598a93">mpi2tcl_comm</a> and <a class="el" href="group__supportfn.html#ga37cba7b1147e19249e7d014ba12440f5">tcl2mpi_comm</a> are then used to translate from one representation to the other while <a class="el" href="group__supportfn.html#ga71b318d6a9100598a0cb5df5df2afba2">tclmpi_add_comm</a> will append a new structure containing the communicator to the list. Correspondingly <a class="el" href="group__supportfn.html#ga2d20c35b877c82a495cee9221c17372e">tclmpi_del_comm</a> will remove a communicator entry from the lest, based on its Tcl string representation.</p>
<h2><a class="anchor" id="tclreq"></a>
Mapping MPI Requests</h2>
<p>MPI requests are represented in TclMPI by strings of the form "tclmpi::req%d", with "%d" being replaced by a unique integer. Internally this map is maintained in a simple linked list to which new requests are appended and from which completed requests are removed as needed. The function <a class="el" href="group__supportfn.html#ga4e65190491cb075c485c810836c197b9">tclmpi_find_req</a> is used to locate a specific request and its associated data from its string label. In addition, <a class="el" href="group__supportfn.html#gaedff82ffce996d8ebf8d12a61f7df48a">tclmpi_add_req</a> will append a new request to the list, and <a class="el" href="group__supportfn.html#gaa0d45ec203f28b828578faebca0dbe3c">tclmpi_del_req</a> will remove (completed) requests.</p>
<h2><a class="anchor" id="tcldata"></a>
Mapping Data Types</h2>
<p>The helper function <a class="el" href="group__supportfn.html#ga4c31b0a0510f230157513a68a2656191">tclmpi_datatype</a> is used to convert string constants representing specific data types into integer constants for convenient branching. Data types in TclMPI are somewhat different from MPI data types to match better the spirit of Tcl scripting.</p>
<h2><a class="anchor" id="tclerr"></a>
Common Error Message Processing</h2>
<p>There is a significant redundancy in checking for and reporting error conditions. For this purpose, several support functions exist.</p>
<p><a class="el" href="group__supportfn.html#ga1833f4a6357d5de800edbee32bd02ed5">tclmpi_errcheck</a> verifies if calls to the MPI library were successful and if not, generates a formatted error message that is appended to the current result list.</p>
<p><a class="el" href="group__supportfn.html#gaa20826953d59c1088731ea5f8ec8640d">tclmpi_commcheck</a> verifies if a communicator argument was using a valid Tcl representation and if not, generates a formatted error message that is appended to the current result list.</p>
<p><a class="el" href="group__supportfn.html#gab6915581c2fd9c294a1e19b21026730d">tclmpi_typecheck</a> test if a type argument was using a valid Tcl representation and if not, generates a formatted error message that is appended to the current result list.</p>
<h1><a class="anchor" id="tcltest"></a>
TclMPI Tcl Test Harness command reference</h1>
<p>TclMPI includes a simple unit test harness written in (of course) Tcl. The corresponding commands are placed into the <a class="el" href="namespacetclmpi__test.html">tclmpi_test</a> namespace. Check out the files in the <code>tests</code> folders for examples. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
