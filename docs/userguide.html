<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TclMPI: TclMPI User&#39;s Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TclMPI
   &#160;<span id="projectnumber">1.1</span>
   </div>
   <div id="projectbrief">Tcl Bindings for MPI</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('userguide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TclMPI User's Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes Tcl bindings for MPI. This package provides a shared object that can be loaded into a Tcl interpreter to provide additional commands that act as an interface to an underlying MPI implementation. This allows to run Tcl scripts in parallel via mpirun or mpiexec similar to C, C++ or Fortran programs and communicate via wrappers to MPI function call.</p>
<p>The original motivation for writing this package was to complement a Tcl wrapper for the LAMMPS molecular dynamics simulation software, but also allow using the VMD molecular visualization and analysis package in parallel without having to recompile VMD and using a convenient API to people that already know how to program parallel programs with MPI in C, C++ or Fortran.</p>
<h1><a class="anchor" id="compile"></a>
Compilation</h1>
<p>The package currently consist of a single C source file which usually will be compiled for dynamic linkage, but can also be compiled into a new Tcl interpreter with TclMPI included (required on some platforms that require static linkage) and a Tcl script file. In addition the package contains some examples, a simple unit test harness (implemented in Tcl) and a set of tests to be run with either one MPI rank (test01, test02) or two MPI ranks (test03, test04).</p>
<p>The build system uses CMake (version 3.16 or later) and has been confirmed to work on Linux, macOS, and Windows using a variety of C compilers (GNU, Clang, Intel, PGI, MSVC). You need to have both, Tcl and MPI installed including their respective development support packages (sometimes called SDK). The MPI library has to be at least MPI-2 standard compliant and the Tcl version should be 8.5 or later. When compiled for a dynamically loaded shared object (DSO) or DLL file, the MPI library has to be compiled and linked with support for building shared libraries as well.</p>
<p>To configure and build TclMPI you need to run CMake the usual way, in a console window with with: </p><div class="fragment"><div class="line">cmake -B  build-folder -S .</div>
<div class="line">cmake   --build build-folder</div>
<div class="line">cmake   --install build-folder</div>
</div><!-- fragment --><p> There are a few settings that can be used to adjust what is compiled and installed and where. The following settings are supported:</p><ul>
<li>BUILD_TCLMPI_SHELL Build a <code>tclmpish</code> executable as extended Tcl shell (default: on)</li>
<li>ENABLE_TCL_STUBS Use the Tcl stubs mechanism (default: on, requires Tcl 8.6 or later)</li>
<li>CMAKE_INSTALL_PREFIX Path to installation location prefix (default: (platform specific))</li>
<li>BUILD_TESTING Enable unit testing (default: on)</li>
<li>DOWNLOAD_MPICH4WIN Download MPICH2-1.4.1 headers and link library (default: off, only supported when cross-compiling on Linux for Windows)</li>
</ul>
<p>To change settings from the defaults append <code>-D&lt;SETTING&gt;=&lt;VALUE&gt;</code> to the <code>cmake</code> command line and replace <code>&lt;SETTING&gt;</code> and <code>&lt;VALUE&gt;</code> accordingly or you may use the <code>ccmake</code> text mode UI or <code>cmake-gui</code>.</p>
<h1><a class="anchor" id="gendocs"></a>
Building the Documentation</h1>
<p>Documentation in HTML and PDF format is extracted from the sources using doxygen, if available. The build of the HTML format documentation is requested with </p><div class="fragment"><div class="line">cmake --build build-folder --target html</div>
</div><!-- fragment --><p> The documentation will be in folder <code>build-folder/html</code>. To generate the PDF documentation, PDFLaTeX and several LaTeX style packages need to be installed. This is requested using </p><div class="fragment"><div class="line">cmake --build build-folder --target pdf</div>
</div><!-- fragment --><p> and the resulting documentation will be in <code>build-folder/tclmpi_docs.pdf</code>.</p>
<h1><a class="anchor" id="install"></a>
Installation</h1>
<p>To install the TclMPI package you can use </p><div class="fragment"><div class="line">cmake --build build-folder --target install</div>
</div><!-- fragment --><p> which should by default install the compiled shared object and the associated two Tcl files into a subfolder of <code>&lt;CMAKE_INSTALL_PREFIX&gt;/tcl8.6</code>. The default value of CMAKE_INSTALL_PREFIX is system specific, but it can changed with <code>-D CMAKE_INSTALL_PREFIX=/some/path</code> when configuring with CMake, then the installation will be into the corresponding location.</p>
<p>To tell Tcl where to find the package, you need to either set or expand the TCLLIBPATH environment variable to the folder into which you have installed the files or place <code>auto_path [concat /usr/local/tcl8.6/ $auto_path]</code> at the beginning of your Tcl script or in your <code>.tclshrc</code> file (or .vmdrc or similar). Then you should be able to load the TclMPI wrappers on demand by using the command <code>package require tclmpi</code>.</p>
<p>For the extended Tcl shell <code>tclmpish</code>, the <code>_tclmpi.so</code> file is not used and instead <code>tclmpish</code> already includes the coresponding code and needs to be run instead of <code>tclsh</code>. For that you may append the <code>bin</code> folder of the installation tree to your PATH environment variable. In case of using the custom Tcl shell, the startup script would be called <code>.tclmpishrc</code> instead of <code>.tclshrc</code>.</p>
<h1><a class="anchor" id="devel"></a>
Software Development and Bug Reports</h1>
<p>The TclMPI code is maintained using git for source code management, and the project is hosted on github at <a href="https://github.com/akohlmey/tclmpi">https://github.com/akohlmey/tclmpi</a> From there you can download snapshots of the development and releases, clode the repository to follow development, or work on your own branch through forking it. Bug reports and feature requests should also be filed on github at through the issue tracker at: <a href="https://github.com/akohlmey/tclmpi/issues">https://github.com/akohlmey/tclmpi/issues</a>.</p>
<h1><a class="anchor" id="examples"></a>
Example Programs</h1>
<p>The following section provides some simple examples using TclMPI to recreate some common MPI example programs in Tcl.</p>
<h2><a class="anchor" id="hello"></a>
Hello World</h2>
<p>This is the TclMPI version of "hello world". </p><div class="fragment"><div class="line">#!/usr/bin/env tclsh</div>
<div class="line">package require tclmpi 1.1</div>
<div class="line"> </div>
<div class="line"># initialize MPI</div>
<div class="line">::tclmpi::init</div>
<div class="line"> </div>
<div class="line"># get size of communicator and rank of process</div>
<div class="line">set comm tclmpi::comm_world</div>
<div class="line">set size [::tclmpi::comm_size $comm]</div>
<div class="line">set rank [::tclmpi::comm_rank $comm]</div>
<div class="line"> </div>
<div class="line">puts &quot;hello world, this is rank $rank of $size&quot;</div>
<div class="line"> </div>
<div class="line"># shut down MPI</div>
<div class="line">::tclmpi::finalize</div>
<div class="line">exit 0</div>
</div><!-- fragment --><h2><a class="anchor" id="mypi"></a>
Computation of Pi</h2>
<p>This script uses TclMPI to compute the value of Pi from numerical quadrature of the integral: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \pi = \int^1_0 {\frac{4}{1 + x^2}} dx \]" src="form_0.png" width="96" height="33"/>
</p>
 <div class="fragment"><div class="line">#!/usr/bin/env tclsh</div>
<div class="line">package require tclmpi 1.1</div>
<div class="line"> </div>
<div class="line"># initialize MPI</div>
<div class="line">::tclmpi::init</div>
<div class="line"> </div>
<div class="line">set comm tclmpi::comm_world</div>
<div class="line">set size [::tclmpi::comm_size $comm]</div>
<div class="line">set rank [::tclmpi::comm_rank $comm]</div>
<div class="line">set master 0</div>
<div class="line"> </div>
<div class="line">set num [lindex $argv 0]</div>
<div class="line"># make sure all processes have the same interval parameter</div>
<div class="line">set num [::tclmpi::bcast $num ::tclmpi::int $master $comm]</div>
<div class="line"> </div>
<div class="line"># run parallel calculation</div>
<div class="line">set h [expr {1.0/$num}]</div>
<div class="line">set sum 0.0</div>
<div class="line">for {set i $rank} {$i &lt; $num} {incr i $size} {</div>
<div class="line">    set sum [expr {$sum + 4.0/(1.0 + ($h*($i+0.5))**2)}]</div>
<div class="line">}</div>
<div class="line">set mypi [expr {$h * $sum}]</div>
<div class="line"> </div>
<div class="line"># combine and print results</div>
<div class="line">set mypi [::tclmpi::allreduce $mypi tclmpi::double \</div>
<div class="line">            tclmpi::sum $comm]</div>
<div class="line">if {$rank == $master} {</div>
<div class="line">    set rel [expr {abs(($mypi - 3.14159265358979)/3.14159265358979)}]</div>
<div class="line">    puts &quot;result: $mypi. relative error: $rel&quot;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># shut down MPI</div>
<div class="line">::tclmpi::finalize</div>
<div class="line">exit 0</div>
</div><!-- fragment --><h2><a class="anchor" id="distsum"></a>
Distributed Sum</h2>
<p>This is a small example version that distributes a data set and computes the sum across all elements in parallel.</p>
<div class="fragment"><div class="line">#!/usr/bin/env tclsh</div>
<div class="line">package require tclmpi 1.1</div>
<div class="line"> </div>
<div class="line"># data summation helper function</div>
<div class="line">proc sum {data} {</div>
<div class="line">    set sum 0</div>
<div class="line">    foreach d $data {</div>
<div class="line">        set sum [expr {$sum + $d}]</div>
<div class="line">    }</div>
<div class="line">    return $sum</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">::tclmpi::init</div>
<div class="line"> </div>
<div class="line">set comm       $tclmpi::comm_world</div>
<div class="line">set mpi_sum    $tclmpi::sum</div>
<div class="line">set mpi_double $tclmpi::double</div>
<div class="line">set mpi_int    $tclmpi::int</div>
<div class="line"> </div>
<div class="line">set size [::tclmpi::comm_size $comm]</div>
<div class="line">set rank [::tclmpi::comm_rank $comm]</div>
<div class="line">set master 0</div>
<div class="line"> </div>
<div class="line"># The master creates the list of data</div>
<div class="line">#</div>
<div class="line">set dataSize 1000000</div>
<div class="line">set data {}</div>
<div class="line">if { $comm == $master } {</div>
<div class="line">    set mysum 0</div>
<div class="line">    for { set i 0 } { $i &lt; $dataSize } { incr i } {</div>
<div class="line">        lappend data $i</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># add padding, so the number of data elements is divisible</div>
<div class="line"># by the number of processors as required by tclmpi::scatter</div>
<div class="line">set needpad [expr {$dataSize % $size}]</div>
<div class="line">set numpad [expr {$needpad ? ($size - $needpad) : 0}]</div>
<div class="line">if { [comm_rank $comm] == $master } {</div>
<div class="line">    for {set i 0} {$i &lt; $numpad} {incr i} {</div>
<div class="line">        lappend data 0</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">set blocksz [expr {($dataSize + $numpad)/ $size}]</div>
<div class="line"> </div>
<div class="line"># distribute data and do the summation on each node</div>
<div class="line"># the sum the result across all nodes. Note: the data</div>
<div class="line"># is integer, but we need to do the full sum in double</div>
<div class="line"># precison to avoid overflows.</div>
<div class="line">set mydata [::tclmpi::scatter $data $mpi_int $master $comm]</div>
<div class="line">set sum [::tclmpi::allreduce [sum $mydata] $mpi_double $mpi_sum $comm]</div>
<div class="line"> </div>
<div class="line">if { $comm == $master } {</div>
<div class="line">    puts &quot;Distributed sum: $sum&quot;</div>
<div class="line">}</div>
<div class="line">::tclmpi::finalize</div>
</div><!-- fragment --><h1><a class="anchor" id="tclapi"></a>
TclMPI Tcl command reference</h1>
<p>All TclMPI Tcl commands are placed into the <a class="el" href="namespacetclmpi.html">tclmpi</a> namespace. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
